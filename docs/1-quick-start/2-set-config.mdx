---
sidebar_position: 2
---

# å‡†å¤‡é…ç½®

:::tip

é…ç½®æ–‡ä»¶ä¸­ï¼Œ`env` ä¸ºå½“å‰ç¯å¢ƒï¼Œ`dependHouYi` å’Œ `dependRabbit` ä¸ºæ˜¯å¦ä¾èµ–åç¾¿å’Œæœˆå…”ç»„ä»¶ï¼Œ`server.name` ä¸ºå½“å‰ç»„ä»¶åç§°ï¼Œ`server.httpEndpoint` å’Œ `server.grpcEndpoint` ä¸ºå½“å‰ç»„ä»¶çš„ http å’Œ grpc åœ°å€ï¼Œ`server.network` ä¸ºå½“å‰ç»„ä»¶çš„ç½‘ç»œç±»å‹ï¼Œ`server.metadata` ä¸ºå½“å‰ç»„ä»¶çš„æè¿°å’ŒèƒŒæ™¯ï¼Œ`http` å’Œ `grpc` ä¸ºå½“å‰ç»„ä»¶çš„ http å’Œ grpc é…ç½®ï¼Œ`cache` ä¸ºå½“å‰ç»„ä»¶çš„ç¼“å­˜é…ç½®ï¼Œ`database` ä¸ºå½“å‰ç»„ä»¶çš„æ•°æ®åº“é…ç½®ï¼Œ`bizDatabase` ä¸ºå½“å‰ç»„ä»¶çš„ä¸šåŠ¡æ•°æ®åº“é…ç½®ï¼Œ`alarmDatabase` ä¸ºå½“å‰ç»„ä»¶çš„å‘Šè­¦æ•°æ®åº“é…ç½®ï¼Œ`log` ä¸ºå½“å‰ç»„ä»¶çš„æ—¥å¿—é…ç½®ï¼Œ`oauth2` ä¸ºå½“å‰ç»„ä»¶çš„ oauth2 é…ç½®ï¼Œ`email_config` ä¸ºå½“å‰ç»„ä»¶çš„é‚®ä»¶é…ç½®ï¼Œ`oss` ä¸ºå½“å‰ç»„ä»¶çš„ oss é…ç½®

:::

import Tabs from '@theme/Tabs'
import TabItem from '@theme/TabItem'

<Tabs>
<TabItem value="palace" label="Palace">

```yaml title="palace é…ç½®æ–‡ä»¶"
env: dev
dependHouYi: true
dependRabbit: true
server:
  name: 'Palace'
  metadata:
    description: palaceæ˜¯moonç›‘æ§ç³»åˆ—çš„ç›‘æ§å¹³å°ï¼Œç”¨äºç®¡ç†å‘Šè­¦ã€ç›‘æ§ã€é…ç½®ã€æ—¥å¿—ã€æ•°æ®æºç­‰
    background: å¯“æ„ä¸ºæœˆå®«ï¼Œè¡¨ç¤ºmoonç³»åˆ—çš„ç»Ÿä¸€ç®¡ç†å¹³å°

http:
  addr: 0.0.0.0:8000
  timeout: 50s

grpc:
  addr: 0.0.0.0:9000
  timeout: 50s

jwt:
  sign_key: 'moon-sign_key'
  issuer: 'moon-palace'
  expire: 3600s

  allow_list:
    - /api.admin.authorization.Authorization/Login
    - /api.admin.authorization.Authorization/Captcha
    - /api.admin.authorization.Authorization/CreatePassword
    - /api.Health/Check
    - /api.Alert/Hook
    - /api.admin.authorization.Authorization/VerifyEmail
    - /api.admin.authorization.Authorization/SetEmailWithLogin

cache:
  driver: 'redis'
  redis:
    network: 'tcp'
    addr: redis.middleware.svc.cluster.local:6379
    db: 0
    password: 'lQz8OMgje7UyoD'
    read_timeout: 0.2s
    write_timeout: 0.2s
    dial_timeout: 0.2s

database:
  driver: 'mysql'
  debug: false
  dsn: 'root:FfVodQL2BLo02H@tcp(mysql.middleware.svc.cluster.local:3306)/moon?charset=utf8mb4&parseTime=True&loc=Local'

bizDatabase:
  driver: 'mysql'
  debug: false
  dsn: 'root:FfVodQL2BLo02H@tcp(mysql.middleware.svc.cluster.local:3306)/'

alarmDatabase:
  driver: 'mysql'
  debug: false
  dsn: 'root:FfVodQL2BLo02H@tcp(mysql.middleware.svc.cluster.local:3306)/'

log:
  type: 'slog'
  level: 'debug'
  slog:
    json: true

oauth2:
  redirect_uri: 'https://moon.aide-cloud.cn'
  github:
    client_id: ''
    client_secret: ''
    callback_uri: 'https://moon.aide-cloud.cn/api/auth/github/callback'
    scopes:
      - 'user'
      - 'email'
  gitee:
    client_id: ''
    client_secret: ''
    callback_uri: 'https://moon.aide-cloud.cn/api/auth/gitee/callback'
    scopes:
      - 'user_info'
      - 'emails'

email_config:
  host: smtp.163.com
  port: 25
  user:
  pass:

oss:
  type: 'local'
  limitSize:
    yml:
      max: 524228
    yaml:
      max: 524228
  local:
    path: './data/moon_oss'
    url: https://moon.aide-cloud.cn/api
    downloadPre: '/file/download'
```

</TabItem>

<TabItem value="houyi" label="HouYi">

```yaml title="houyi é…ç½®æ–‡ä»¶"
env: dev

dependPalace: true
server:
  name: moon_houyi
  httpEndpoint: 'houyi.application.svc.cluster.local:8001'
  grpcEndpoint: 'houyi.application.svc.cluster.local:9001'
  network: 'rpc'
  metadata:
    description: æ˜¯moonç›‘æ§ç³»åˆ—çš„å‘Šè­¦ç»„ä»¶ï¼Œå¯ä»¥ç‹¬ç«‹éƒ¨ç½²ï¼Œæ¥å—promç±»å‹è§„åˆ™ï¼Œä¹Ÿå¯ä»¥æ¥å—alertmanagerç±»å‹ç»„ä»¶çš„å‘Šè­¦æ¨é€
    background: å¯“æ„ä¸ºå¤©ç¥åç¾¿ï¼Œä¸“é—¨ç”¨äºç›‘æ§è§„åˆ™å‘Šè­¦äº‹ä»¶
http:
  addr: 0.0.0.0:8001
  timeout: 50s
grpc:
  addr: 0.0.0.0:9001
  timeout: 50s

cache:
  driver: 'redis'
  redis:
    network: 'tcp'
    addr: redis.middleware.svc.cluster.local:6379
    db: 0
    password: 'lQz8OMgje7UyoD'
    read_timeout: 0.2s
    write_timeout: 0.2s
    dial_timeout: 0.2s

watch:
  strategy:
    timeout: 10s
    interval: '@every 10s'
  alertEvent:
    timeout: 10s
    interval: 10s

palace_server:
  network: 'rpc'
  nodeVersion: ''
  endpoint: 'palace.application.svc.cluster.local:9000'
  timeout: 50s
  secret: ''
```

</TabItem>

<TabItem value="rabbit" label="Rabbit">

```yaml title="rabbit é…ç½®æ–‡ä»¶"
env: dev

dependPalace: true
server:
  name: moon_rabbit
  httpEndpoint: 'rabbit.application.svc.cluster.local:8002'
  grpcEndpoint: 'rabbit.application.svc.cluster.local:9002'
  network: 'rpc'
  secret: ''
  metadata:
    description: æ˜¯moonç›‘æ§ç³»åˆ—çš„æ¶ˆæ¯ç»„ä»¶ï¼Œå¯ä»¥ç‹¬ç«‹éƒ¨ç½²ï¼Œæ¥å—ä»»æ„çš„hookæ¶ˆæ¯ï¼Œå¹¶æ”¯æŒé‚®ä»¶ã€é’‰é’‰ã€ä¼ä¸šå¾®ä¿¡ã€é£ä¹¦ç­‰å‘Šè­¦
    background: å¯“æ„ä¸ºæœˆå®«ä¸­çš„ç‰å…”ï¼Œä¸“é—¨ç”¨äºæ¶ˆæ¯é€šçŸ¥

http:
  addr: 0.0.0.0:8002
  timeout: 2s
grpc:
  addr: 0.0.0.0:9002
  timeout: 2s

log:
  type: 'slog'
  level: 'debug'
  slog:
    json: true

cache:
  driver: 'redis'
  redis:
    network: 'tcp'
    addr: redis.middleware.svc.cluster.local:6379
    db: 0
    password: 'lQz8OMgje7UyoD'
    read_timeout: 0.2s
    write_timeout: 0.2s
    dial_timeout: 0.2s

global_email_config:
  host: smtp.163.com
  port: 25
  user:
  pass:

palace_server:
  network: 'rpc'
  nodeVersion: ''
  endpoint: 'palace.application.svc.cluster.local:9000'
  timeout: 50s
  secret: ''

# TODO è°ƒæ•´æ¨¡æ¿ç»“æ„ï¼Œ æ”¯æŒå¤šç§Ÿæˆ·
templates:
  email: |
    <h1>ç›‘æ§å‘Šè­¦</h1>
    <p>{{ .annotations.summary }}</p>
    <p>{{ .annotations.description }}</p>
    <p>æ—¶é—´: {{ .startsAt }} è‡³ {{ .endsAt }}</p>
  dingtalk: |
    {{- $status := .status -}}
    {{- $labels := .labels -}}
    {{- $annotations := .annotations -}}

    {
        "msgtype": "markdown",
        "markdown": {
          "title": "å¹³å°çŠ¶æ€é€šçŸ¥",
          "text": "### {{if eq $status `resolved`}}âœ… å‘Šè­¦å·²æ¢å¤{{else}}ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ ç´§æ€¥å‘Šè­¦é€šçŸ¥{{end}}\n\n  \n**æ—¶é—´**: `{{ .startsAt }}` è‡³ `{{ .endsAt }}`  \n\n<hr/>\n\n**æ‘˜è¦**:  \n`{{ $annotations.summary }}`  \n\n**æè¿°**:  \n`{{ $annotations.description }}`  \n\n<hr/>\n\n**æ ‡ç­¾**:  \n- **æ•°æ®æº ID**: {{ index $labels "__moon__datasource_id__" }}  \n- **æ•°æ®æº URL**: [é“¾æ¥]({{ index $labels "__moon__datasource_url__" }})  \n- **çº§åˆ« ID**: {{ index $labels "__moon__level_id__" }}  \n- **ç­–ç•¥ ID**: {{ index $labels "__moon__strategy_id__" }}  \n- **å›¢é˜Ÿ ID**: {{ index $labels "__moon__team_id__" }}  \n- **å®ä¾‹**: `{{ index $labels "instance" }}`  \n- **IP**: `{{ index $labels "ip" }}`  \n- **ä½œä¸š**: `{{ index $labels "job" }}`  \n\n<hr/>\n\nè¯·æ ¹æ®ä»¥ä¸Šä¿¡æ¯è¿›è¡Œåç»­å¤„ç†ï¼"
        }
    }

  feishu: |
    {
        "msg_type": "interactive",
        "card": {
            "config": {
                "wide_screen_mode": true
            },
            "header": {
                "title": {
                    "tag": "plain_text",
                    "content": "{{if eq .status `resolved`}}âœ… å‘Šè­¦å·²æ¢å¤{{else}}ğŸš¨ ç´§æ€¥å‘Šè­¦é€šçŸ¥{{end}}"
                },
                "template": "{{if eq .status `resolved`}}green{{else}}red{{end}}"
            },
            "elements": [
                {
                    "tag": "div",
                    "fields": [
                        {
                            "is_short": false,
                            "text": {
                                "tag": "lark_md",
                                "content": "**ğŸ” å‘Šè­¦æ‘˜è¦**\n{{.annotations.summary}}"
                            }
                        },
                        {
                            "is_short": false,
                            "text": {
                                "tag": "lark_md",
                                "content": "**ğŸ” å‘Šè­¦æè¿°**\n{{.annotations.description}}"
                            }
                        },
                        {
                            "is_short": false,
                            "text": {
                                "tag": "lark_md",
                                "content": "**ğŸ” å¼€å§‹æ—¶é—´**\n{{.startsAt}}"
                            }
                        },
                        {
                            "is_short": false,
                            "text": {
                                "tag": "lark_md",
                                "content": "{{if eq .status `resolved`}}**ğŸ” æ¢å¤æ—¶é—´**\n{{.endsAt}}{{end}}"
                            }
                        }
                    ]
                },
                {
                    "tag": "hr"
                },
                {
                  "tag": "div",
                  "fields": [
                    {
                      "is_short": true,
                      "text": {
                        "tag": "lark_md",
                        "content": "**â— çŠ¶æ€**\n<font color=\"warning\">{{.status}}</font>"
                      }
                    },
                    {
                      "is_short": true,
                      "text": {
                        "tag": "lark_md",
                        "content": "**ğŸŒ æ•°æ®æº**\n[ç‚¹å‡»æŸ¥çœ‹]({{.labels.__moon__datasource_url__}})"
                      }
                    },
                    {
                      "is_short": true,
                      "text": {
                        "tag": "lark_md",
                        "content": "**ğŸ“› å‘Šè­¦åç§°**\n<font color=\"info\">{{.labels.__name__}}</font>"
                      }
                    },
                    {
                      "is_short": true,
                      "text": {
                        "tag": "lark_md",
                        "content": "**ğŸ”— ç­–ç•¥ ID**\n{{.labels.__moon__strategy_id__}}"
                      }
                    },
                    {
                      "is_short": true,
                      "text": {
                        "tag": "lark_md",
                        "content": "**ğŸ†” å›¢é˜Ÿ ID**\n{{.labels.__moon__team_id__}}"
                      }
                    },
                    {
                      "is_short": true,
                      "text": {
                        "tag": "lark_md",
                        "content": "**ğŸ’» IP åœ°å€**\n{{.labels.ip}}"
                      }
                    }
                  ]
                },
                {
                    "tag": "hr"
                },
                {
                    "tag": "action",
                    "actions": [
                        {
                            "tag": "button",
                            "text": {
                                "tag": "lark_md",
                                "content": "ğŸ“„ æŸ¥çœ‹è¯¦æƒ…"
                            },
                            "url": "{{.labels.__moon__datasource_url__}}",
                            "type": "primary"
                        }
                    ]
                }
            ]
        }
    }

  wechat: |
    {
        "msgtype": "markdown",
        "markdown": {
          "content": "### {{if eq .status `resolved`}}âœ… å‘Šè­¦å·²æ¢å¤{{else}}ğŸš¨ ç´§æ€¥å‘Šè­¦é€šçŸ¥{{end}}\n\n {{ .annotations }}"
        }
    }
```

</TabItem>

</Tabs>
